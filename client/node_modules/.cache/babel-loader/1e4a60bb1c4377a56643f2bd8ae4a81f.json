{"ast":null,"code":"import{useD3}from'./hooks/useD3';import React from\"react\";import*as d3 from'd3';import*as flextree from'd3-flextree';import{propTypes}from'react-bootstrap/esm/Image';import{useHistory}from'react-router-dom';function GraphUI(_ref){var parentContext=_ref.parentContext;var ref=useD3(function(svg){var width=window.innerWidth,height=window.innerHeight;// Remove the old svg\nd3.selectAll(\"g > *\").remove();// append the svg object to the body of the page\nvar g=svg.attr(\"width\",width).attr(\"height\",height).append(\"g\").attr('transform',\"translate(\".concat(width/2,\",100)\"));var duration=750;var i=0,root=d3.hierarchy(parentContext.state.treeData,function(d){return d.children;});console.log(\"Fancy UI\",root);// Collapse after second level\nif(root.children!=undefined){root.children.forEach(collapse);root.x0=0;root.y0=0;}var flexLayout=flextree.flextree();update(root);// Collapse the node and all it's children\nfunction collapse(d){if(d.children){d._children=d.children;d._children.forEach(collapse);d.children=null;}}function update(source){// Assigns the x and y position for the nodes\nvar treeData=flexLayout(root);// Compute the new tree layout.\nvar nodes=treeData.descendants(),links=treeData.descendants().slice(1);// ****************** Nodes section ***************************\n// Update the nodes...\nvar node=g.selectAll('g.node').data(nodes,function(d){return d.id||(d.id=++i);});// Enter any new modes at the parent's previous position.\nvar nodeEnter=node.enter().append('g').attr('class','node').attr(\"transform\",function(d){return\"translate(\"+source.x0+\",\"+source.y0+\")\";});// Add Circle for the nodes\nnodeEnter.append('circle').attr('class','node').attr('r',1e-6).style(\"fill\",function(d){return d._children?\"lightsteelblue\":\"#fff\";});// Add labels for the nodes\nnodeEnter.append('text').attr('pointer-events','none').attr('dy','0.35em').text(function(d){return d.data.name;}).attr('text-anchor','middle');var timer=0;var delay=200;var prevent=false;// Update\nvar nodeUpdate=nodeEnter.merge(node).attr(\"fill\",\"#fff\").attr(\"stroke\",\"black\").attr(\"stroke-width\",\"3px;\").style('font','12px consolas').on(\"click\",function(d,i){var _this=this;timer=setTimeout(function(){if(!prevent){toggleButton(_this,d,i);}prevent=false;},delay);}).on(\"dblclick\",function(d,i){clearTimeout(timer);prevent=true;click(d,i);});// Transition to the proper position for the node\nnodeUpdate.transition().duration(duration).attr(\"transform\",function(event,i,arr){var d=d3.select(this).datum();return\"translate(\"+d.x+\",\"+d.y+\")\";});// Update the node attributes and style\nnodeUpdate.select('circle.node').attr('r',50).style(\"fill\",function(d){return d._children?\"lightsteelblue\":\"#fff\";}).style('-webkit-touch-callout','none').style('-webkit-user-select','none').style('-khtml-user-select','none').style('-moz-user-select','none').style('-ms-user-select','none').style('user-select','none').attr('cursor','pointer');// Create Event Handlers for toggling buttons\nfunction toggleButton(context,d,i){if(nodeUpdate.select('#button'+i.data.id).empty()){// Add buttons\nvar arc1=d3.arc().innerRadius(55).outerRadius(75).startAngle(0).endAngle(30*Math.PI/180);var arc2=d3.arc().innerRadius(55).outerRadius(75).startAngle(35*Math.PI/180).endAngle(65*Math.PI/180);var arc3=d3.arc().innerRadius(55).outerRadius(75).startAngle(70*Math.PI/180).endAngle(100*Math.PI/180);var arc4=d3.arc().innerRadius(55).outerRadius(75).startAngle(105*Math.PI/180).endAngle(135*Math.PI/180);d3.select(context).append('path').attr('id','button'+i.data.id).attr('d',arc1).attr('cursor','pointer').attr('fill','#7FFFD4').on('click',handleAddChild);d3.select(context).append('path').attr('id','button'+i.data.id).attr('d',arc2).attr('cursor','pointer').attr('fill','#FF00FF').on('click',handleAddSibling);d3.select(context).append('path').attr('id','button'+i.data.id).attr('d',arc3).attr('cursor','pointer').attr('fill','#00FF00').on('click',handleEdit);d3.select(context).append('path').attr('id','button'+i.data.id).attr('d',arc4).attr('cursor','pointer').attr('fill','#FF6347').on('click',handleDelete);}else{// Delete button\nnodeUpdate.selectAll('#button'+i.data.id).remove();d3.select(context).on(\"click\",function(d,i){var _this2=this;timer=setTimeout(function(){if(!prevent){toggleButton(_this2,d,i);}prevent=false;},delay);});}}function handleAddChild(d,i){alert(\"add child\");// console.log(this.props)\nparentContext.addChild({variables:{_id:i.data.id}});d.stopPropagation();// Prevent propagation to parent\n}function handleAddSibling(d,i){alert(\"add sibling\");parentContext.addSibling({variables:{_id:i.data.id}});d.stopPropagation();// Prevent propagation to parent\n}function handleEdit(d,i){// const history = useHistory();\nlocalStorage.setItem(\"current_id\",i.data.id);alert(\"edit\");window.location.href=\"/\";// history.push(\"note/\" + i.data.id)\n// history.push(\"note/\" + i.data.id)\nd.stopPropagation();// Prevent propagation to parent\n}function handleDelete(d,i){alert(\"delete\");parentContext.deleteNote({variables:{_id:i.data.id}});d.stopPropagation();// Prevent propagation to parent\n}// Remove any exiting nodes\nvar nodeExit=node.exit().transition().duration(duration).attr(\"transform\",function(event,i,arr){var d=d3.select(this).datum();return\"translate(\"+source.x+\",\"+source.y+\")\";}).remove();// On exit reduce the node circles size to 0\nnodeExit.select('circle').attr('r',1e-6);// On exit reduce the opacity of text labels\nnodeExit.select('text').style('fill-opacity',1e-6);// ****************** links section ******************\n// Update the links...\nvar link=g.selectAll('path.link').data(links,function(d){return d.id;});// Enter any new links at the parent's previous position.\nvar linkEnter=link.enter().insert('path',\"g\").attr(\"class\",\"link\").attr('d',function(d){var o={x:source.x0,y:source.y0};return diagonal(o,o);});// UPDATE\nvar linkUpdate=linkEnter.merge(link).attr(\"fill\",\"none\").attr(\"stroke\",\"#ccc\").attr(\"stroke-width\",\"2px\");// Transition back to the parent element position\nlinkUpdate.transition().duration(duration).attr('d',function(d){return diagonal(d,d.parent);});// Remove any exiting links\nvar linkExit=link.exit().transition().duration(duration).attr('d',function(event,i,arr){var d=d3.select(this).datum();var o={x:source.x,y:source.y};return diagonal(o,o);}).remove();// Store the old positions for transition.\nnodes.forEach(function(d){d.x0=d.x;d.y0=d.y;});// Creates a curved (diagonal) path from parent to the child nodes\nfunction diagonal(s,d){var path=\"M \".concat(s.x,\" \").concat(s.y,\"\\n                  C \").concat((s.x+d.x)/2,\" \").concat(s.y,\",\\n                  \").concat((s.x+d.x)/2,\" \").concat(d.y,\",\\n                  \").concat(d.x,\" \").concat(d.y);return path;}// Toggle children on click.\nfunction click(event,d){if(d.children){d._children=d.children;d.children=null;}else{d.children=d._children;d._children=null;}update(d);}}},[parentContext.state.treeData]);return/*#__PURE__*/React.createElement(\"svg\",{ref:ref,style:{height:1000,width:\"100%\",marginRight:\"0px\",marginLeft:\"0px\"}});}export default GraphUI;","map":{"version":3,"sources":["/home/shailesh/Projects/Trees/Trees/client/src/GraphUI.js"],"names":["useD3","React","d3","flextree","propTypes","useHistory","GraphUI","parentContext","ref","svg","width","window","innerWidth","height","innerHeight","selectAll","remove","g","attr","append","duration","i","root","hierarchy","state","treeData","d","children","console","log","undefined","forEach","collapse","x0","y0","flexLayout","update","_children","source","nodes","descendants","links","slice","node","data","id","nodeEnter","enter","style","text","name","timer","delay","prevent","nodeUpdate","merge","on","setTimeout","toggleButton","clearTimeout","click","transition","event","arr","select","datum","x","y","context","empty","arc1","arc","innerRadius","outerRadius","startAngle","endAngle","Math","PI","arc2","arc3","arc4","handleAddChild","handleAddSibling","handleEdit","handleDelete","alert","addChild","variables","_id","stopPropagation","addSibling","localStorage","setItem","location","href","deleteNote","nodeExit","exit","link","linkEnter","insert","o","diagonal","linkUpdate","parent","linkExit","s","path","marginRight","marginLeft"],"mappings":"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","sourcesContent":["import { useD3 } from './hooks/useD3';\nimport React from \"react\";\nimport * as d3 from 'd3';\nimport * as flextree from 'd3-flextree'\nimport { propTypes } from 'react-bootstrap/esm/Image';\nimport { useHistory } from 'react-router-dom';\n\n\nfunction GraphUI({ parentContext }) {\n  const ref = useD3(\n    (svg) => {\n      var width = window.innerWidth,\n        height = window.innerHeight;\n\n      // Remove the old svg\n      d3.selectAll(\"g > *\").remove();\n\n      // append the svg object to the body of the page\n      const g = svg\n        .attr(\"width\", width)\n        .attr(\"height\", height)\n        .append(\"g\")\n        .attr('transform', `translate(${width / 2},100)`)\n\n\n      const duration = 750;\n      let i = 0,\n        root = d3.hierarchy(parentContext.state.treeData, function (d) {\n          return d.children;\n        });\n\n      console.log(\"Fancy UI\", root)\n      // Collapse after second level\n      if (root.children != undefined) {\n        root.children.forEach(collapse);\n        root.x0 = 0;\n        root.y0 = 0;\n      }\n\n      const flexLayout = flextree.flextree();\n\n      update(root);\n      // Collapse the node and all it's children\n      function collapse(d) {\n        if (d.children) {\n          d._children = d.children\n          d._children.forEach(collapse)\n          d.children = null\n        }\n      }\n\n      function update(source) {\n\n        // Assigns the x and y position for the nodes\n        var treeData = flexLayout(root)\n\n        // Compute the new tree layout.\n        var nodes = treeData.descendants(),\n          links = treeData.descendants().slice(1);\n\n        // ****************** Nodes section ***************************\n\n        // Update the nodes...\n        var node = g.selectAll('g.node')\n          .data(nodes, d => d.id || (d.id = ++i));\n\n        // Enter any new modes at the parent's previous position.\n        var nodeEnter = node.enter().append('g')\n          .attr('class', 'node')\n          .attr(\"transform\", function (d) {\n            return \"translate(\" + source.x0 + \",\" + source.y0 + \")\";\n          })\n\n        // Add Circle for the nodes\n        nodeEnter.append('circle')\n          .attr('class', 'node')\n          .attr('r', 1e-6)\n          .style(\"fill\", function (d) {\n            return d._children ? \"lightsteelblue\" : \"#fff\";\n          });\n\n        // Add labels for the nodes\n        nodeEnter.append('text')\n          .attr('pointer-events', 'none')\n          .attr('dy', '0.35em')\n          .text(function (d) {\n            return d.data.name;\n          })\n          .attr('text-anchor', 'middle')\n\n        var timer = 0;\n        var delay = 200;\n        var prevent = false;\n\n        // Update\n        var nodeUpdate = nodeEnter.merge(node)\n          .attr(\"fill\", \"#fff\")\n          .attr(\"stroke\", \"black\")\n          .attr(\"stroke-width\", \"3px;\")\n          .style('font', '12px consolas')\n          .on(\"click\", function (d, i) {\n            timer = setTimeout(() => {\n              if (!prevent) {\n                toggleButton(this, d, i)\n              }\n              prevent = false;\n            }, delay);\n          })\n          .on(\"dblclick\", function (d, i) {\n            clearTimeout(timer);\n            prevent = true;\n            click(d, i)\n          });\n\n        // Transition to the proper position for the node\n        nodeUpdate.transition()\n          .duration(duration)\n          .attr(\"transform\", function (event, i, arr) {\n            const d = d3.select(this).datum();\n            return \"translate(\" + d.x + \",\" + d.y + \")\";\n          });\n\n        // Update the node attributes and style\n        nodeUpdate.select('circle.node')\n          .attr('r', 50)\n          .style(\"fill\", function (d) {\n            return d._children ? \"lightsteelblue\" : \"#fff\";\n          })\n          .style('-webkit-touch-callout', 'none')\n          .style('-webkit-user-select', 'none')\n          .style('-khtml-user-select', 'none')\n          .style('-moz-user-select', 'none')\n          .style('-ms-user-select', 'none')\n          .style('user-select', 'none')\n          .attr('cursor', 'pointer')\n\n        // Create Event Handlers for toggling buttons\n        function toggleButton(context, d, i) {\n          if (nodeUpdate.select('#button' + i.data.id).empty()) {\n            // Add buttons\n            var arc1 = d3.arc()\n              .innerRadius(55)\n              .outerRadius(75)\n              .startAngle(0)\n              .endAngle(30 * Math.PI / 180)\n            var arc2 = d3.arc()\n              .innerRadius(55)\n              .outerRadius(75)\n              .startAngle(35 * Math.PI / 180)\n              .endAngle(65 * Math.PI / 180)\n            var arc3 = d3.arc()\n              .innerRadius(55)\n              .outerRadius(75)\n              .startAngle(70 * Math.PI / 180)\n              .endAngle(100 * Math.PI / 180)\n            var arc4 = d3.arc()\n              .innerRadius(55)\n              .outerRadius(75)\n              .startAngle(105 * Math.PI / 180)\n              .endAngle(135 * Math.PI / 180)\n\n            d3.select(context)\n              .append('path')\n              .attr('id', 'button' + i.data.id)\n              .attr('d', arc1)\n              .attr('cursor', 'pointer')\n              .attr('fill', '#7FFFD4')\n              .on('click', handleAddChild)\n            d3.select(context)\n              .append('path')\n              .attr('id', 'button' + i.data.id)\n              .attr('d', arc2)\n              .attr('cursor', 'pointer')\n              .attr('fill', '#FF00FF')\n              .on('click', handleAddSibling)\n            d3.select(context)\n              .append('path')\n              .attr('id', 'button' + i.data.id)\n              .attr('d', arc3)\n              .attr('cursor', 'pointer')\n              .attr('fill', '#00FF00')\n              .on('click', handleEdit)\n            d3.select(context)\n              .append('path')\n              .attr('id', 'button' + i.data.id)\n              .attr('d', arc4)\n              .attr('cursor', 'pointer')\n              .attr('fill', '#FF6347')\n              .on('click', handleDelete)\n          }\n          else {\n            // Delete button\n            nodeUpdate.selectAll('#button' + i.data.id).remove()\n            d3.select(context)\n              .on(\"click\", function (d, i) {\n                timer = setTimeout(() => {\n                  if (!prevent) {\n                    toggleButton(this, d, i)\n                  }\n                  prevent = false;\n                }, delay);\n              })\n          }\n        }\n\n        function handleAddChild(d, i) {\n          alert(\"add child\")\n          // console.log(this.props)\n          parentContext.addChild({ variables: { _id: i.data.id } })\n          d.stopPropagation()  // Prevent propagation to parent\n        }\n\n        function handleAddSibling(d, i) {\n          alert(\"add sibling\")\n          parentContext.addSibling({ variables: { _id: i.data.id } })\n          d.stopPropagation()  // Prevent propagation to parent\n        }\n\n        function handleEdit(d, i) {\n          // const history = useHistory();\n          localStorage.setItem(\"current_id\", i.data.id);\n          alert(\"edit\")\n          window.location.href = \"/\"\n          \n          // history.push(\"note/\" + i.data.id)\n          // history.push(\"note/\" + i.data.id)\n          d.stopPropagation()  // Prevent propagation to parent\n        }\n\n        function handleDelete(d, i) {\n          alert(\"delete\")\n          parentContext.deleteNote({ variables: { _id: i.data.id } })\n          d.stopPropagation()  // Prevent propagation to parent\n        }\n\n        // Remove any exiting nodes\n        var nodeExit = node.exit().transition()\n          .duration(duration)\n          .attr(\"transform\", function (event, i, arr) {\n            const d = d3.select(this).datum();\n            return \"translate(\" + source.x + \",\" + source.y + \")\";\n          })\n          .remove();\n\n        // On exit reduce the node circles size to 0\n        nodeExit.select('circle')\n          .attr('r', 1e-6);\n\n        // On exit reduce the opacity of text labels\n        nodeExit.select('text')\n          .style('fill-opacity', 1e-6)\n\n        // ****************** links section ******************\n\n        // Update the links...\n        var link = g.selectAll('path.link')\n          .data(links, function (d) {\n            return d.id;\n          });\n\n        // Enter any new links at the parent's previous position.\n        var linkEnter = link.enter().insert('path', \"g\")\n          .attr(\"class\", \"link\")\n          .attr('d', function (d) {\n            var o = {\n              x: source.x0,\n              y: source.y0\n            }\n            return diagonal(o, o)\n          });\n\n        // UPDATE\n        var linkUpdate = linkEnter.merge(link)\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"#ccc\")\n          .attr(\"stroke-width\", \"2px\")\n\n        // Transition back to the parent element position\n        linkUpdate.transition()\n          .duration(duration)\n          .attr('d', function (d) {\n            return diagonal(d, d.parent)\n          });\n\n        // Remove any exiting links\n        var linkExit = link.exit().transition()\n          .duration(duration)\n          .attr('d', function (event, i, arr) {\n            const d = d3.select(this).datum();\n            var o = {\n              x: source.x,\n              y: source.y\n            }\n            return diagonal(o, o)\n          })\n          .remove();\n\n        // Store the old positions for transition.\n        nodes.forEach(function (d) {\n          d.x0 = d.x;\n          d.y0 = d.y;\n        });\n\n        // Creates a curved (diagonal) path from parent to the child nodes\n        function diagonal(s, d) {\n          const path = `M ${s.x} ${s.y}\n                  C ${(s.x + d.x) / 2} ${s.y},\n                  ${(s.x + d.x) / 2} ${d.y},\n                  ${d.x} ${d.y}`\n\n          return path\n        }\n\n        // Toggle children on click.\n        function click(event, d) {\n          if (d.children) {\n            d._children = d.children;\n            d.children = null;\n          } else {\n            d.children = d._children;\n            d._children = null;\n          }\n          update(d);\n        }\n      }\n    },\n    [parentContext.state.treeData]\n  );\n\n  return (\n    <svg\n      ref={ref}\n      style={{\n        height: 1000,\n        width: \"100%\",\n        marginRight: \"0px\",\n        marginLeft: \"0px\",\n      }}\n    >\n      {/* <g className=\"plot-area\" /> */}\n    </svg>\n  );\n}\n\nexport default GraphUI;"]},"metadata":{},"sourceType":"module"}