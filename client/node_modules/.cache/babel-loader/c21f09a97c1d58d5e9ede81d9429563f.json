{"ast":null,"code":"var _jsxFileName = \"/home/shailesh/Projects/Trees/Trees/client/src/GraphUI.js\";\nimport { useD3 } from './hooks/useD3';\nimport React from \"react\";\nimport * as d3 from 'd3';\nimport * as flextree from 'd3-flextree';\nimport { propTypes } from 'react-bootstrap/esm/Image';\nimport { useHistory } from 'react-router-dom';\n\nfunction GraphUI({\n  parentContext\n}) {\n  const ref = useD3(svg => {\n    var width = window.innerWidth,\n        height = window.innerHeight; // Remove the old svg\n\n    d3.selectAll(\"g > *\").remove(); // append the svg object to the body of the page\n\n    const g = svg.attr(\"width\", width).attr(\"height\", height).append(\"g\").attr('transform', `translate(${width / 2},100)`);\n    const duration = 750;\n    let i = 0,\n        root = d3.hierarchy(parentContext.state.treeData, function (d) {\n      return d.children;\n    });\n    console.log(\"Fancy UI\", root); // Collapse after second level\n\n    if (root.children != undefined) {\n      root.children.forEach(collapse);\n      root.x0 = 0;\n      root.y0 = 0;\n    }\n\n    const flexLayout = flextree.flextree();\n    update(root); // Collapse the node and all it's children\n\n    function collapse(d) {\n      if (d.children) {\n        d._children = d.children;\n\n        d._children.forEach(collapse);\n\n        d.children = null;\n      }\n    }\n\n    function update(source) {\n      // Assigns the x and y position for the nodes\n      var treeData = flexLayout(root); // Compute the new tree layout.\n\n      var nodes = treeData.descendants(),\n          links = treeData.descendants().slice(1); // ****************** Nodes section ***************************\n      // Update the nodes...\n\n      var node = g.selectAll('g.node').data(nodes, d => d.id || (d.id = ++i)); // Enter any new modes at the parent's previous position.\n\n      var nodeEnter = node.enter().append('g').attr('class', 'node').attr(\"transform\", function (d) {\n        return \"translate(\" + source.x0 + \",\" + source.y0 + \")\";\n      }); // Add Circle for the nodes\n\n      nodeEnter.append('circle').attr('class', 'node').attr('r', 1e-6).style(\"fill\", function (d) {\n        return d._children ? \"lightsteelblue\" : \"#fff\";\n      }); // Add labels for the nodes\n\n      nodeEnter.append('text').attr('pointer-events', 'none').attr('dy', '0.35em').text(function (d) {\n        return d.data.name;\n      }).attr('text-anchor', 'middle');\n      var timer = 0;\n      var delay = 200;\n      var prevent = false; // Update\n\n      var nodeUpdate = nodeEnter.merge(node).attr(\"fill\", \"#fff\").attr(\"stroke\", \"black\").attr(\"stroke-width\", \"3px;\").style('font', '12px consolas').on(\"click\", function (d, i) {\n        timer = setTimeout(() => {\n          if (!prevent) {\n            toggleButton(this, d, i);\n          }\n\n          prevent = false;\n        }, delay);\n      }).on(\"dblclick\", function (d, i) {\n        clearTimeout(timer);\n        prevent = true;\n        click(d, i);\n      }); // Transition to the proper position for the node\n\n      nodeUpdate.transition().duration(duration).attr(\"transform\", function (event, i, arr) {\n        const d = d3.select(this).datum();\n        return \"translate(\" + d.x + \",\" + d.y + \")\";\n      }); // Update the node attributes and style\n\n      nodeUpdate.select('circle.node').attr('r', 50).style(\"fill\", function (d) {\n        return d._children ? \"lightsteelblue\" : \"#fff\";\n      }).style('-webkit-touch-callout', 'none').style('-webkit-user-select', 'none').style('-khtml-user-select', 'none').style('-moz-user-select', 'none').style('-ms-user-select', 'none').style('user-select', 'none').attr('cursor', 'pointer'); // Create Event Handlers for toggling buttons\n\n      function toggleButton(context, d, i) {\n        if (nodeUpdate.select('#button' + i.data.id).empty()) {\n          // Add buttons\n          var arc1 = d3.arc().innerRadius(55).outerRadius(75).startAngle(0).endAngle(30 * Math.PI / 180);\n          var arc2 = d3.arc().innerRadius(55).outerRadius(75).startAngle(35 * Math.PI / 180).endAngle(65 * Math.PI / 180);\n          var arc3 = d3.arc().innerRadius(55).outerRadius(75).startAngle(70 * Math.PI / 180).endAngle(100 * Math.PI / 180);\n          var arc4 = d3.arc().innerRadius(55).outerRadius(75).startAngle(105 * Math.PI / 180).endAngle(135 * Math.PI / 180);\n          d3.select(context).append('path').attr('id', 'button' + i.data.id).attr('d', arc1).attr('cursor', 'pointer').attr('fill', '#7FFFD4').on('click', handleAddChild);\n          d3.select(context).append('path').attr('id', 'button' + i.data.id).attr('d', arc2).attr('cursor', 'pointer').attr('fill', '#FF00FF').on('click', handleAddSibling);\n          d3.select(context).append('path').attr('id', 'button' + i.data.id).attr('d', arc3).attr('cursor', 'pointer').attr('fill', '#00FF00').on('click', handleEdit);\n          d3.select(context).append('path').attr('id', 'button' + i.data.id).attr('d', arc4).attr('cursor', 'pointer').attr('fill', '#FF6347').on('click', handleDelete);\n        } else {\n          // Delete button\n          nodeUpdate.selectAll('#button' + i.data.id).remove();\n          d3.select(context).on(\"click\", function (d, i) {\n            timer = setTimeout(() => {\n              if (!prevent) {\n                toggleButton(this, d, i);\n              }\n\n              prevent = false;\n            }, delay);\n          });\n        }\n      }\n\n      function handleAddChild(d, i) {\n        alert(\"add child\"); // console.log(this.props)\n\n        parentContext.addChild({\n          variables: {\n            _id: i.data.id\n          }\n        });\n        d.stopPropagation(); // Prevent propagation to parent\n      }\n\n      function handleAddSibling(d, i) {\n        alert(\"add sibling\");\n        parentContext.addSibling({\n          variables: {\n            _id: i.data.id\n          }\n        });\n        d.stopPropagation(); // Prevent propagation to parent\n      }\n\n      function handleEdit(d, i) {\n        const history = useHistory();\n        alert(\"edit\");\n        window.location.href = \"note/\" + i.data.id; // this.props.history.push(\"note/\" + i.data.id)\n        // history.push(\"note/\" + i.data.id)\n\n        d.stopPropagation(); // Prevent propagation to parent\n      }\n\n      function handleDelete(d, i) {\n        alert(\"delete\");\n        parentContext.deleteNote({\n          variables: {\n            _id: i.data.id\n          }\n        });\n        d.stopPropagation(); // Prevent propagation to parent\n      } // Remove any exiting nodes\n\n\n      var nodeExit = node.exit().transition().duration(duration).attr(\"transform\", function (event, i, arr) {\n        const d = d3.select(this).datum();\n        return \"translate(\" + source.x + \",\" + source.y + \")\";\n      }).remove(); // On exit reduce the node circles size to 0\n\n      nodeExit.select('circle').attr('r', 1e-6); // On exit reduce the opacity of text labels\n\n      nodeExit.select('text').style('fill-opacity', 1e-6); // ****************** links section ******************\n      // Update the links...\n\n      var link = g.selectAll('path.link').data(links, function (d) {\n        return d.id;\n      }); // Enter any new links at the parent's previous position.\n\n      var linkEnter = link.enter().insert('path', \"g\").attr(\"class\", \"link\").attr('d', function (d) {\n        var o = {\n          x: source.x0,\n          y: source.y0\n        };\n        return diagonal(o, o);\n      }); // UPDATE\n\n      var linkUpdate = linkEnter.merge(link).attr(\"fill\", \"none\").attr(\"stroke\", \"#ccc\").attr(\"stroke-width\", \"2px\"); // Transition back to the parent element position\n\n      linkUpdate.transition().duration(duration).attr('d', function (d) {\n        return diagonal(d, d.parent);\n      }); // Remove any exiting links\n\n      var linkExit = link.exit().transition().duration(duration).attr('d', function (event, i, arr) {\n        const d = d3.select(this).datum();\n        var o = {\n          x: source.x,\n          y: source.y\n        };\n        return diagonal(o, o);\n      }).remove(); // Store the old positions for transition.\n\n      nodes.forEach(function (d) {\n        d.x0 = d.x;\n        d.y0 = d.y;\n      }); // Creates a curved (diagonal) path from parent to the child nodes\n\n      function diagonal(s, d) {\n        const path = `M ${s.x} ${s.y}\n                  C ${(s.x + d.x) / 2} ${s.y},\n                  ${(s.x + d.x) / 2} ${d.y},\n                  ${d.x} ${d.y}`;\n        return path;\n      } // Toggle children on click.\n\n\n      function click(event, d) {\n        if (d.children) {\n          d._children = d.children;\n          d.children = null;\n        } else {\n          d.children = d._children;\n          d._children = null;\n        }\n\n        update(d);\n      }\n    }\n  }, [parentContext.state.treeData]);\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    ref: ref,\n    style: {\n      height: 1000,\n      width: \"100%\",\n      marginRight: \"0px\",\n      marginLeft: \"0px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 5\n    }\n  });\n}\n\nexport default GraphUI;","map":{"version":3,"sources":["/home/shailesh/Projects/Trees/Trees/client/src/GraphUI.js"],"names":["useD3","React","d3","flextree","propTypes","useHistory","GraphUI","parentContext","ref","svg","width","window","innerWidth","height","innerHeight","selectAll","remove","g","attr","append","duration","i","root","hierarchy","state","treeData","d","children","console","log","undefined","forEach","collapse","x0","y0","flexLayout","update","_children","source","nodes","descendants","links","slice","node","data","id","nodeEnter","enter","style","text","name","timer","delay","prevent","nodeUpdate","merge","on","setTimeout","toggleButton","clearTimeout","click","transition","event","arr","select","datum","x","y","context","empty","arc1","arc","innerRadius","outerRadius","startAngle","endAngle","Math","PI","arc2","arc3","arc4","handleAddChild","handleAddSibling","handleEdit","handleDelete","alert","addChild","variables","_id","stopPropagation","addSibling","history","location","href","deleteNote","nodeExit","exit","link","linkEnter","insert","o","diagonal","linkUpdate","parent","linkExit","s","path","marginRight","marginLeft"],"mappings":"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","sourcesContent":["import { useD3 } from './hooks/useD3';\nimport React from \"react\";\nimport * as d3 from 'd3';\nimport * as flextree from 'd3-flextree'\nimport { propTypes } from 'react-bootstrap/esm/Image';\nimport { useHistory } from 'react-router-dom';\n\n\nfunction GraphUI({ parentContext }) {\n  const ref = useD3(\n    (svg) => {\n      var width = window.innerWidth,\n        height = window.innerHeight;\n\n      // Remove the old svg\n      d3.selectAll(\"g > *\").remove();\n\n      // append the svg object to the body of the page\n      const g = svg\n        .attr(\"width\", width)\n        .attr(\"height\", height)\n        .append(\"g\")\n        .attr('transform', `translate(${width / 2},100)`)\n\n\n      const duration = 750;\n      let i = 0,\n        root = d3.hierarchy(parentContext.state.treeData, function (d) {\n          return d.children;\n        });\n\n      console.log(\"Fancy UI\", root)\n      // Collapse after second level\n      if (root.children != undefined) {\n        root.children.forEach(collapse);\n        root.x0 = 0;\n        root.y0 = 0;\n      }\n\n      const flexLayout = flextree.flextree();\n\n      update(root);\n      // Collapse the node and all it's children\n      function collapse(d) {\n        if (d.children) {\n          d._children = d.children\n          d._children.forEach(collapse)\n          d.children = null\n        }\n      }\n\n      function update(source) {\n\n        // Assigns the x and y position for the nodes\n        var treeData = flexLayout(root)\n\n        // Compute the new tree layout.\n        var nodes = treeData.descendants(),\n          links = treeData.descendants().slice(1);\n\n        // ****************** Nodes section ***************************\n\n        // Update the nodes...\n        var node = g.selectAll('g.node')\n          .data(nodes, d => d.id || (d.id = ++i));\n\n        // Enter any new modes at the parent's previous position.\n        var nodeEnter = node.enter().append('g')\n          .attr('class', 'node')\n          .attr(\"transform\", function (d) {\n            return \"translate(\" + source.x0 + \",\" + source.y0 + \")\";\n          })\n\n        // Add Circle for the nodes\n        nodeEnter.append('circle')\n          .attr('class', 'node')\n          .attr('r', 1e-6)\n          .style(\"fill\", function (d) {\n            return d._children ? \"lightsteelblue\" : \"#fff\";\n          });\n\n        // Add labels for the nodes\n        nodeEnter.append('text')\n          .attr('pointer-events', 'none')\n          .attr('dy', '0.35em')\n          .text(function (d) {\n            return d.data.name;\n          })\n          .attr('text-anchor', 'middle')\n\n        var timer = 0;\n        var delay = 200;\n        var prevent = false;\n\n        // Update\n        var nodeUpdate = nodeEnter.merge(node)\n          .attr(\"fill\", \"#fff\")\n          .attr(\"stroke\", \"black\")\n          .attr(\"stroke-width\", \"3px;\")\n          .style('font', '12px consolas')\n          .on(\"click\", function (d, i) {\n            timer = setTimeout(() => {\n              if (!prevent) {\n                toggleButton(this, d, i)\n              }\n              prevent = false;\n            }, delay);\n          })\n          .on(\"dblclick\", function (d, i) {\n            clearTimeout(timer);\n            prevent = true;\n            click(d, i)\n          });\n\n        // Transition to the proper position for the node\n        nodeUpdate.transition()\n          .duration(duration)\n          .attr(\"transform\", function (event, i, arr) {\n            const d = d3.select(this).datum();\n            return \"translate(\" + d.x + \",\" + d.y + \")\";\n          });\n\n        // Update the node attributes and style\n        nodeUpdate.select('circle.node')\n          .attr('r', 50)\n          .style(\"fill\", function (d) {\n            return d._children ? \"lightsteelblue\" : \"#fff\";\n          })\n          .style('-webkit-touch-callout', 'none')\n          .style('-webkit-user-select', 'none')\n          .style('-khtml-user-select', 'none')\n          .style('-moz-user-select', 'none')\n          .style('-ms-user-select', 'none')\n          .style('user-select', 'none')\n          .attr('cursor', 'pointer')\n\n        // Create Event Handlers for toggling buttons\n        function toggleButton(context, d, i) {\n          if (nodeUpdate.select('#button' + i.data.id).empty()) {\n            // Add buttons\n            var arc1 = d3.arc()\n              .innerRadius(55)\n              .outerRadius(75)\n              .startAngle(0)\n              .endAngle(30 * Math.PI / 180)\n            var arc2 = d3.arc()\n              .innerRadius(55)\n              .outerRadius(75)\n              .startAngle(35 * Math.PI / 180)\n              .endAngle(65 * Math.PI / 180)\n            var arc3 = d3.arc()\n              .innerRadius(55)\n              .outerRadius(75)\n              .startAngle(70 * Math.PI / 180)\n              .endAngle(100 * Math.PI / 180)\n            var arc4 = d3.arc()\n              .innerRadius(55)\n              .outerRadius(75)\n              .startAngle(105 * Math.PI / 180)\n              .endAngle(135 * Math.PI / 180)\n\n            d3.select(context)\n              .append('path')\n              .attr('id', 'button' + i.data.id)\n              .attr('d', arc1)\n              .attr('cursor', 'pointer')\n              .attr('fill', '#7FFFD4')\n              .on('click', handleAddChild)\n            d3.select(context)\n              .append('path')\n              .attr('id', 'button' + i.data.id)\n              .attr('d', arc2)\n              .attr('cursor', 'pointer')\n              .attr('fill', '#FF00FF')\n              .on('click', handleAddSibling)\n            d3.select(context)\n              .append('path')\n              .attr('id', 'button' + i.data.id)\n              .attr('d', arc3)\n              .attr('cursor', 'pointer')\n              .attr('fill', '#00FF00')\n              .on('click', handleEdit)\n            d3.select(context)\n              .append('path')\n              .attr('id', 'button' + i.data.id)\n              .attr('d', arc4)\n              .attr('cursor', 'pointer')\n              .attr('fill', '#FF6347')\n              .on('click', handleDelete)\n          }\n          else {\n            // Delete button\n            nodeUpdate.selectAll('#button' + i.data.id).remove()\n            d3.select(context)\n              .on(\"click\", function (d, i) {\n                timer = setTimeout(() => {\n                  if (!prevent) {\n                    toggleButton(this, d, i)\n                  }\n                  prevent = false;\n                }, delay);\n              })\n          }\n        }\n\n        function handleAddChild(d, i) {\n          alert(\"add child\")\n          // console.log(this.props)\n          parentContext.addChild({ variables: { _id: i.data.id } })\n          d.stopPropagation()  // Prevent propagation to parent\n        }\n\n        function handleAddSibling(d, i) {\n          alert(\"add sibling\")\n          parentContext.addSibling({ variables: { _id: i.data.id } })\n          d.stopPropagation()  // Prevent propagation to parent\n        }\n\n        function handleEdit(d, i) {\n          const history = useHistory();\n  \n \n          \n          alert(\"edit\")\n          window.location.href = \"note/\" + i.data.id\n          // this.props.history.push(\"note/\" + i.data.id)\n          // history.push(\"note/\" + i.data.id)\n          d.stopPropagation()  // Prevent propagation to parent\n        }\n\n        function handleDelete(d, i) {\n          alert(\"delete\")\n          parentContext.deleteNote({ variables: { _id: i.data.id } })\n          d.stopPropagation()  // Prevent propagation to parent\n        }\n\n        // Remove any exiting nodes\n        var nodeExit = node.exit().transition()\n          .duration(duration)\n          .attr(\"transform\", function (event, i, arr) {\n            const d = d3.select(this).datum();\n            return \"translate(\" + source.x + \",\" + source.y + \")\";\n          })\n          .remove();\n\n        // On exit reduce the node circles size to 0\n        nodeExit.select('circle')\n          .attr('r', 1e-6);\n\n        // On exit reduce the opacity of text labels\n        nodeExit.select('text')\n          .style('fill-opacity', 1e-6)\n\n        // ****************** links section ******************\n\n        // Update the links...\n        var link = g.selectAll('path.link')\n          .data(links, function (d) {\n            return d.id;\n          });\n\n        // Enter any new links at the parent's previous position.\n        var linkEnter = link.enter().insert('path', \"g\")\n          .attr(\"class\", \"link\")\n          .attr('d', function (d) {\n            var o = {\n              x: source.x0,\n              y: source.y0\n            }\n            return diagonal(o, o)\n          });\n\n        // UPDATE\n        var linkUpdate = linkEnter.merge(link)\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"#ccc\")\n          .attr(\"stroke-width\", \"2px\")\n\n        // Transition back to the parent element position\n        linkUpdate.transition()\n          .duration(duration)\n          .attr('d', function (d) {\n            return diagonal(d, d.parent)\n          });\n\n        // Remove any exiting links\n        var linkExit = link.exit().transition()\n          .duration(duration)\n          .attr('d', function (event, i, arr) {\n            const d = d3.select(this).datum();\n            var o = {\n              x: source.x,\n              y: source.y\n            }\n            return diagonal(o, o)\n          })\n          .remove();\n\n        // Store the old positions for transition.\n        nodes.forEach(function (d) {\n          d.x0 = d.x;\n          d.y0 = d.y;\n        });\n\n        // Creates a curved (diagonal) path from parent to the child nodes\n        function diagonal(s, d) {\n          const path = `M ${s.x} ${s.y}\n                  C ${(s.x + d.x) / 2} ${s.y},\n                  ${(s.x + d.x) / 2} ${d.y},\n                  ${d.x} ${d.y}`\n\n          return path\n        }\n\n        // Toggle children on click.\n        function click(event, d) {\n          if (d.children) {\n            d._children = d.children;\n            d.children = null;\n          } else {\n            d.children = d._children;\n            d._children = null;\n          }\n          update(d);\n        }\n      }\n    },\n    [parentContext.state.treeData]\n  );\n\n  return (\n    <svg\n      ref={ref}\n      style={{\n        height: 1000,\n        width: \"100%\",\n        marginRight: \"0px\",\n        marginLeft: \"0px\",\n      }}\n    >\n      {/* <g className=\"plot-area\" /> */}\n    </svg>\n  );\n}\n\nexport default GraphUI;"]},"metadata":{},"sourceType":"module"}